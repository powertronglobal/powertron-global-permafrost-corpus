{"chunk_id": "umontana_001_chunk_0001", "doc_id": "umontana_001", "slug": "umontana-ml-validation", "sequence": 1, "text": "Advanced Data Science Projects Documentation\n\n[Student Researcher A]:\n\n[student-a@university.edu], \n\n[Student Researcher B]:\n\n[student-b@university.edu], \n\n[Student Researcher C]\n\n[student-c@university.edu]\n\nExecutive Summary:\n\nThroughout this exploration, our team was focused on anomaly detection of HVAC units. The detection of these anomalies would show poor efficiency in such HVAC units. By using a variety of preprocessing techniques, modeling techniques, and clustering techniques, our team was able to find these analogous system performances prior to Powertron Globals implementation. Through the use of two datasets, we were able to find analogous efficiency performance in HVAC systems. By doing this, our team was able to conclude that the use of Powertron Global’s supplement resulted in the efficiency of HVAC systems located on a cell tower to return back to expected system performance.\n\nIntroduction:\n\nThe M567-467 University of Montana Advanced Data Science projects team conducted research during the 2022 spring semester at the request of Powertron Global. The data provided consisted of data recorded by monitoring sensors on heating and cooling HVAC units.\n\nThe team was given two data sets to analyze, (1) data from a Department Store A store location and (2) data from a cell phone tower unit in California. Our team analyzed different aspects of the dataset and tested various algorithms and model performances on these data and the following report documents our findings.\n\nDescription of Project/Data:\n\nOur goal was to create a model that accurately represents the HVAC in optimal operating conditions. The Powertron Global company provides a product that cleans and optimizes cooling units. We were able to use the data after optimization of the cooling units as training data for our modeling process. The data we received contained various metrics that pertain to HVAC system performance\n\nObjectives:\n\nThe team started by defining the objectives of our modeling process. We set out to:\n\nDevelop a method for detecting anomalies or changes in system performance:\n\nVisualize the process and the variables associated with the project.\n\nDetermine accurate models for predicting system efficiency from internal and external variables.\n\nUse an accurate prediction model to detect Anomalies.\n\nLocal outlier Factor\n\nCluster outliers\n\nRaw Data:\n\nDuring the process of exploring and understanding the data sets we were provided with we were informed our principal efforts should be directed at the cellphone tower data as opposed to the Macy’s data. We decided to train our models on the system after Powertron Global’s treatment. The reasoning behind that decision was based on the idea that post treatment data should represent the system when running as close to optimal efficiency as possible. We used the pre treatment data to represent the system when running in less than optimal conditions, however there is no guarantee that the system was running sub-optimally before treatment. Also, the data we were provided contained 21 variables. The table below consists of all 21 variables that were present to us during our project.\n\nname\n\ncfm\n\nCOP\n\nDelta_Enthalpy\n\ndewpoint1\n\ndewpoint2\n\nVariables\n\neer\n\nkw\n\nkwton\n\nOAtemp\n\nhumidity1\n\ntemp1\n\nenthalpy1\n\nhumidity2\n\ntemp2\n\nenthalpy2\n\ntime\n\nCompressor 1\n\nCompressor 2\n\nCompressor 3\n\nCompressor 4\n\nTable 1: Variables in Cell Tower Dataset", "tokens": 663, "chars": 3385, "pages": {"start": 1, "end": 1}, "section": "", "prev_id": "", "next_id": "umontana_001_chunk_0002", "content_hash": "sha256:6fcb61224fa4a4a422cc9610d05b26af5cf7c5f9a8c9a9973fd5d73e841a8334"}
{"chunk_id": "umontana_001_chunk_0002", "doc_id": "umontana_001", "slug": "umontana-ml-validation", "sequence": 2, "text": "The table below consists of all 21 variables that were present to us during our project.\n\nname\n\ncfm\n\nCOP\n\nDelta_Enthalpy\n\ndewpoint1\n\ndewpoint2\n\nVariables\n\neer\n\nkw\n\nkwton\n\nOAtemp\n\nhumidity1\n\ntemp1\n\nenthalpy1\n\nhumidity2\n\ntemp2\n\nenthalpy2\n\ntime\n\nCompressor 1\n\nCompressor 2\n\nCompressor 3\n\nCompressor 4\n\nTable 1: Variables in Cell Tower Dataset\n\nAlso, our team took the two datasets and splitted them into training and testing sets. A training set is used so our model can get a good understanding of the data. By using the independent variables provided by the user and the Retail Chain A variable outcomes, the model can learn how much the Retail Chain A variables are affected by the independent variables. The testing set is used to determine how accurate the model can predict the Retail Chain A variables. The time spans that our team decided to train and test our models on for the Department Store A dataset and cellphone tower dataset are as follows. For the Macy’s dataset, the timeframe we decided to train our data on was from 05-15-2020 to 12-16-2020. The testing dates for the Macy’s dataset were from 10-01-2019 to 05-15-2020. On the other hand, the training dates for the cellphone tower dataset were from 07-13-2021 to 01-31-2022, while the testing dates for this dataset were from 07-06-2021 to 07-13-2021.\n\n \n\nData Preprocessing:\n\nBefore training and testing our models on the data, our team implemented a number of preprocessing techniques. These techniques included creating new variables that were not in the dataset prior, dropping observations that happened thirty seconds after a compressor turned on, resampling the data, and dealing with extreme values. The first 30 seconds after a compressor turns on often yields values indicative of very low efficiency. The low efficiency values did not persist after those 30 seconds and were deemed not indicative of overall system performance, thus these observations were dropped from the dataset before training and testing our models. Also, there were a few instances where the measure for kwton was in the high one hundreds to two hundred range. Since this was not persistent throughout the rest of the dataset, our team decided to exclude these values for the most part throughout the study. These values will be talked about more in the next section.\n\nChallenges/Early date outliers:\n\nThe cell phone tower data contained a period spanning from 06-26-2021 to 06-30-2021 which contained values that were not consistent with the rest of the data . Depending on the analysis these data points were sometimes omitted from analysis. The following figure shows the range of days that contained values not consistent with the rest of the data.\n\nFigure 1: Anomalous data points, which were dissimilar to the rest of the dataset.\n\nResampling:\n\nThe data had an overwhelmingly large amount of observations which posed computational and memory problems. Resampling to a different time interval was necessary to reduce data volume. Resampling also serves to smooth out, remove and reduce ephemeral system changes. We used the median value of each variable over a 30 second or 1 minute time frame, which down-sampled the data by 30-60 observations per minute. Also, by using the median when resampling, we were able to limit the range of extreme values in the dataset. After resampling by 30 seconds, the dataset still contained 241,029 observations.\n\nClean/Processed Data:", "tokens": 748, "chars": 3427, "pages": {"start": 1, "end": 1}, "section": "", "prev_id": "umontana_001_chunk_0001", "next_id": "umontana_001_chunk_0003", "content_hash": "sha256:6e373510e4ca277f7ec4fce99a9bac23a9d7572c71a70ae3c8426b0a8b2cf545"}
{"chunk_id": "umontana_001_chunk_0003", "doc_id": "umontana_001", "slug": "umontana-ml-validation", "sequence": 3, "text": "dian value of each variable over a 30 second or 1 minute time frame, which down-sampled the data by 30-60 observations per minute. Also, by using the median when resampling, we were able to limit the range of extreme values in the dataset. After resampling by 30 seconds, the dataset still contained 241,029 observations.\n\nClean/Processed Data:\n\nWe chose 3 performance indicators COP , EER , and Kwton to use as our Retail Chain A variables. The reader should note that COP and EER are highly correlated. The following figure illustrates the correlations of each exogenous variable to our Retail Chain A variables during a one second and 30 second resampling period. This figure was computed using the dataset after pre-processing and shows the differences between 1 second data points and 30 second aggregated data points.\n\nThe magnitude of the correlation coefficients are larger in the 30 second data. Therefore, it’s concluded that 30 second resampling provides more information about trend(s) over time.\n\nFigure 2. A correlation heatmap on the cell phone tower data across various features and Retail Chain A variables.\n\nVariable choices:\n\nWe chose EER, COP, and Kwton as our Retail Chain A vectors because they are key performance indicators. When building a model, accurately predicting these variables when the system is running at optimal performance allows for determination of when the system is running sub-optimally by comparison. To further explore these three key performance indicators, we will briefly explain how each one is measured. First, KW/ton is a measure of efficiency that can be calculated by taking the Peak Power Draw (kw) and dividing it by Peak cooling consumption (tons). Next, we have EER. EER is also a measure of efficiency which can be calculated by dividing the British Thermal Units (BTU) by the wattage. Lastly, we have COP, which can be calculated by the ratio between energy usage of the compressor and the amount of useful cooling at the evaporator.\n\nModel Variable choices:\n\nTo reduce the computational strain we selected a subsample of the total data set to use as predictive variables. The variables used in each of the three models are shown in the following table.\n\nModel\n\nRandom Forest\n\nGradient Boosting Regressor\n\nLight Gradient Boosting Regressor\n\nVariables\n\nCFM\n\nCFM\n\nCFM\n\nDelta Enthalpy\n\nDelta Enthalpy\n\nDelta Enthalpy\n\nOAtemp\n\nOAtemp\n\nOAtemp\n\nHumidity 1\n\nHumidity 1\n\nHumidity 1\n\nTemp 1\n\nTemp 1\n\nTemp 1\n\nDay of Week\n\nDay of Week\n\nDay of Week\n\nHour of Day\n\nHour of Day\n\nHour of Day\n\nMonth\n\nMonth\n\nMonth\n\nName\n\nName\n\nName\n\nKw\n\nKw\n\nKw\n\nTable 2: Variable Choices\n\nBefore creating our models, our team decided to create three new variables to incorporate. These variables created were Day of Week, Hour of Day, and month, which can be seen in the table above. Our team decided to create the feature Day of Week because we thought there would be a difference in system performance on the weekends when compared to weekdays. Also, our teams’ idea of creating the Hour of Day feature was because we thought system usage would be less during the early morning hours and late night hours than midday hours, thus resulting in different system performance when compared to that of mid-day. Lastly, we decided to create the Month feature for the same reason as the other two variables. During the cold months the system may be running at different efficiencies when compared to that of a warmer month.\n\nModeling:", "tokens": 743, "chars": 3452, "pages": {"start": 1, "end": 1}, "section": "", "prev_id": "umontana_001_chunk_0002", "next_id": "umontana_001_chunk_0004", "content_hash": "sha256:a4f15bc3ff0443545d1afbd1100fcd6c548a2bcfddb57ff5af8faec3abae8fd5"}
{"chunk_id": "umontana_001_chunk_0004", "doc_id": "umontana_001", "slug": "umontana-ml-validation", "sequence": 4, "text": "urs and late night hours than midday hours, thus resulting in different system performance when compared to that of mid-day. Lastly, we decided to create the Month feature for the same reason as the other two variables. During the cold months the system may be running at different efficiencies when compared to that of a warmer month.\n\nModeling:\n\nBefore implementing our models, our team created a pipeline. A pipeline takes our predictor variables, either categorical or numerical, and transforms them so our models can be more accurate. Within our pipeline, we used two transformers and an imputer. The transformers used were OneHotEncoding and StandardScaler. OneHotEncoding takes categorical variables and transforms them into binary features. On the other hand, StandardScaler standardizes each of the numerical features. To do this, the StandardScaler subtracts the mean of the column from such observation, then divides the value by the standard deviation of the column. Lastly, the imputer is used if there are empty values in the column. If there are empty values present, the imputer will take the median of the column and replace the empty value with the median.\n\n \n\nOur team decided to use three different models when training and testing the data. The three models we chose were all based on ensembles of regression trees. The three models used are as follows: Random Forest, Gradient Boosting Regressor, and Light Gradient Boosting Regressor. A random forest is a classification algorithm which consists of many decision trees. Each decision tree in the random forest then returns a class prediction. Since there are multiple trees in a random forest, the class that appears the most often becomes the model’s prediction. Now onto the gradient boosting regressor. A gradient boosting regressor uses a multitude of weak learners (decision trees) and combines new learners to minimize overall prediction error. Similarly, a light gradient boosting regressor is a modified gradient booster meant to achieve higher efficiency in computations. To test the accuracy of these models, we computed a pseudo R2 value of four different time frames. The pseudo R2 value can be computed by taking the square of the standard deviation of the Retail Chain A vector, subtracting the mean of the residuals squared from this value, then dividing such value by the standard deviation of the Retail Chain A vector squared. These time frames were the pre-treatment data, post-treatment data, 500 hour window after the implementation of Powertron’s product, and the validation set. The pseudo R2 values for each of the three models can be seen in the following tables.\n\nGradient Boosting Regressor Pseudo R2:\n\nRetail Chain A Variable\n\nPre Treatment\n\nValidation Set\n\nPost Treatment\n\n500 H Window\n\nKwton\n\n0.951796\n\n0.993803\n\n0.997733\n\n0.997099\n\nEER\n\n0.856326\n\n0.992138\n\n0.998030\n\n0.996766\n\nCOP\n\n0.760850\n\n0.995814\n\n0.998230\n\n0.997538\n\nRandom Forest Regressor Pseudo R2\n\nRetail Chain A Variable\n\nPre Treatment\n\nValidation Set\n\nPost Treatment\n\n500 H Window\n\nKwton\n\n0.816706\n\n0.668728\n\n0.930982\n\nEER\n\n0.471107\n\n0.973788\n\n0.974240\n\nCOP\n\n0.326350\n\n0.970241\n\n0.970543\n\nLight Gradient Boosting Regressor Pseudo R2\n\nRetail Chain A Variable\n\nPre Treatment\n\nValidation Set\n\nPost Treatment\n\n500 H Window\n\nKwton\n\n0.85889462984\n\n0.95050715149\n\n0.94422054833\n\n0.81599396522\n\nEER\n\n0.59739868630\n\n0.99718873343\n\n0.99749245370\n\n-0.01600525334\n\nCOP\n\n0.56181917580\n\n0.99754186266\n\n0.99780246004\n\n0.10205124206", "tokens": 817, "chars": 3481, "pages": {"start": 1, "end": 1}, "section": "", "prev_id": "umontana_001_chunk_0003", "next_id": "umontana_001_chunk_0005", "content_hash": "sha256:341ae2eee80a70a1187e85a5afc912744ff1bbda9c00dd17d3aa219378cdb52c"}
{"chunk_id": "umontana_001_chunk_0005", "doc_id": "umontana_001", "slug": "umontana-ml-validation", "sequence": 5, "text": "0.970241\n\n0.970543\n\nLight Gradient Boosting Regressor Pseudo R2\n\nRetail Chain A Variable\n\nPre Treatment\n\nValidation Set\n\nPost Treatment\n\n500 H Window\n\nKwton\n\n0.85889462984\n\n0.95050715149\n\n0.94422054833\n\n0.81599396522\n\nEER\n\n0.59739868630\n\n0.99718873343\n\n0.99749245370\n\n-0.01600525334\n\nCOP\n\n0.56181917580\n\n0.99754186266\n\n0.99780246004\n\n0.10205124206\n\nFeature importances:\n\nAll the models tested are variations of ensembles of decision trees, these models produce metrics on feature importances used to make accurate predictions, the following series of figures show feature importances for each Retail Chain A variable.\n\nKW/TON (above)\n\nCOP (above)\n\nEER (above)\n\nClustering:\n\nClustering methods were evaluated on the residuals produced by our models. Residuals in our context, is defined as the difference between observed Retail Chain A variable values and a model’s predicted Retail Chain A variable values. When a residual data point has a high value it generally means that there was a large difference between the system during optimal performance and the observed system performance value. The goal of this analysis was to perform unsupervised learning to identify time periods of inefficiency, efficiency or time periods with anomalous efficiency values.\n\nWe compared the results of three different clustering algorithms, Kmeans, DBscan and agglomerative clustering.\n\nTwo scoring methods were used to evaluate the clustering model performance,(1) Inertia and (2) the silhouette score. The method kmeans is measured by the metric called inertia, which measures how well a data set was clustered. It is calculated by measuring the distance between each data point and its cluster centroid, squaring this distance, and summing these squares across one cluster. A good silhouette score is a high one. The Agglomerative and DBscan are measured by their silhouette score. Otherwise known as the goodness of a clustering technique. Its value ranges from -1 to 1.\n\n1: Means clusters are well apart from each other and clearly distinguished.\n\n0: Means clusters are indifferent, or we can say that the distance between clusters is not significant.\n\n-1: Means clusters are assigned in the wrong way.\n\nWe choose agglomerative clustering as the best method because of its computational efficiency and high silhouette scores when compared to the other two methods of clustering. Using the agglomerative method, we clustered the post treatment data set and categorized 3 clusters as the efficient operating conditions. We then calculated the distances of clusters in the pre treatment data. Points were classified as anomalous if they were beyond a 2 standard deviation distance from the efficient cluster centers.\n\nThe following  figure illustrates the percentage of anomalous data points in 8 hour windows spanning from the pre-treatment to the post-treatment data set.\n\nDiscussion:\n\nIn brief, the approach characterizes system efficiency when the system is believed to be operating efficiently Characterization is accomplished by modeling the 3 efficiency measures (Kwton, COP, and EER) The model accounts for exogenous conditions hour of day, day of week, and month. Departure from efficiency is measured by predicting efficiency via a model for a 30 second time intervals and measuring the difference from the actual & predicted efficiencies large deparetues indicate poor efficiency. Departures are  aggregated over several 8 hour periods. The 8 hour departures from optimal performance become the final measure of system efficiency. \n\nThe Local Outlier factor:", "tokens": 744, "chars": 3557, "pages": {"start": 1, "end": 1}, "section": "", "prev_id": "umontana_001_chunk_0004", "next_id": "umontana_001_chunk_0006", "content_hash": "sha256:3db3abab2d43d0f2148ec47b4eeb5f3ae2e424cd4f2d200bee4140d5f8856767"}
{"chunk_id": "umontana_001_chunk_0006", "doc_id": "umontana_001", "slug": "umontana-ml-validation", "sequence": 6, "text": "by predicting efficiency via a model for a 30 second time intervals and measuring the difference from the actual & predicted efficiencies large deparetues indicate poor efficiency. Departures are  aggregated over several 8 hour periods. The 8 hour departures from optimal performance become the final measure of system efficiency. \n\nThe Local Outlier factor:\n\nLocal outlier factor was another method utilized to identify differences in performance in the different time periods. The goal of this method is to assign an anomaly score to each data point based on its position to the points around it. There are two methods we used for this approach. One was to train a predictive model for outliers on the post treatments data. In this course of action, points were given an outlier or inlier score [-1,1], respectively. This allowed our team to observe how the number of outliers to inliers changed over time. The other method considered was to assign a quantitative value to how “unusual” a point was with respect to “nearby” data. This process produces anomaly score values from ~1 → positive infinity. The larger the value, the more anomalous the data point.\n\nThe figure (above) demonstrates the method of determining how anomalous a point is compared to “nearby” data. The left column of graphs shows the distributions of Kw/ton, COP, and EER for a day in the pre-treatment period while the right column shows the same distributions for a day in the post-treatment time period. The colorbar (right) applies to all the plots and displays the gradient for the anomaly scores..\n\nCluster distances:\n\nTwo clusters were found to represent the system during optimal performance. We measured the average distance over an 8 hour period to each of the cluster's core points. When graphed over time from the beginning of the data set to the end it is observable that the average distance to each cluster decreases, implying that the system gets closer to consistent optimal performance by the end of the treatment period. The method of clustering residuals also proved to be a satisfactory method of characterizing system performance.\n\nConclusions:\n\nThe 567 - 467 projects team spent the spring of 2022 working with data provided by Powertron global. The team found that it is possible to accurately predict HVAC system performance based on measured sensor data points and ambient features.  Once accurate models were produced, it was possible to characterize recorded system performance based on their deviations from the models representation of optimal performance. These terms were residuals. A data point with a large residual value represented a moment of inefficiency as opposed to a residual with a low value which represented the system performing close to optimal conditions. The team then was able to characterize types of inefficiency. By using clustering and the Local Outlier Factor we are able to observe the system performance enhancements that are provided by the Powertron Global HVAC efficiency treatment. This model could be used to predict or observe novel HVAC systems to show prospective customers how inefficiently their current systems are performing and illustrate how this product could be beneficial.\n\nAppendix of Graphs:\n\n(above) Feature importances for COP models trained on each compressor unit in the cell phone tower data (unit 458 left, unit 459 right).\n\n(above) Residuals for each unit’s model for their respective data/times with time periods colored(unit 458 top, unit 459 bottom).\n\n(above) The residuals for each unit model plotted together (458 blue, 459 red)\n\n(below) The models predictions across all the data (unit 458 blue, unit 459 red) with a lowess smooth curve added displayed in the first two plots. The last two show the residuals overlayed with plotting orders reversed between the plots and the 95th and 5th quantiles width added.\n\n(above) A plot of the percentage of values over 25 for kwton for different time interval aggregations. (The y-axis is in ##.##% format, so 0.00% to 0.25% is the axis range)", "tokens": 810, "chars": 4047, "pages": {"start": 1, "end": 1}, "section": "", "prev_id": "umontana_001_chunk_0005", "next_id": "umontana_001_chunk_0007", "content_hash": "sha256:cd1ccd2d1304c93e7066edbcc20efaa7e622858ff57dfe26ceb12f205342ac9f"}
{"chunk_id": "umontana_001_chunk_0007", "doc_id": "umontana_001", "slug": "umontana-ml-validation", "sequence": 7, "text": "(unit 458 blue, unit 459 red) with a lowess smooth curve added displayed in the first two plots. The last two show the residuals overlayed with plotting orders reversed between the plots and the 95th and 5th quantiles width added.\n\n(above) A plot of the percentage of values over 25 for kwton for different time interval aggregations. (The y-axis is in ##.##% format, so 0.00% to 0.25% is the axis range)\n\n(above) These are various displays of model performance for KW/TON on the pre-treatment data. (Light Gradient Booster)\n\n(above) These are various displays of model performance for KW/TON on the validation set of the post-treatment data. (Light Gradient Booster)\n\n(above) KW/TON residuals across the entire time frame with time periods separated by color (Y-axis limited).\n\n(above) Quantile plot of KW/TON residuals\n\n(above) These are various displays of model performance for COP on pre-treatment data. (Light Gradient Booster)\n\n(above) These are various displays of model performance for COP on the validation set of the post-treatment data. (Light Gradient Booster)\n\n(above) COP residuals across the entire time frame with time periods separated by color (Y-axis limited).\n\n(above) Quantile plot of COP residuals\n\n(above) These are various displays of model performance for EER on the pre-treatment data. (Light Gradient Booster)\n\n(above) These are various displays of model performance for EER on the validation set of the post-treatment data. (Light Gradient Booster)\n\n(above) EER residuals across the entire time frame with time periods separated by color (Y-axis limited).\n\n(above) Quantile plot of EER residuals.\n\n(above) Feature importances across the different models. (Light Gradient Booster)\n\n(below) This figure shows the residuals (gold) for COP, the zero line (blue), the width from the 95th quantile to the 5th quantile of COP centered around zero (green), the recorded values of KW/TON (red), and the scaled inverse of COP predictions in an attempt to obtain KW/TON (cyan). Sundays are the highlighted block(s). This is the pre-treatment time.\n\n(below) This shows the residuals (gold) for COP, the zero line (blue), the width from the 95th quantile to the 5th quantile of COP centered around zero (green), the recorded values of KW/TON (red), and the scaled inverse of COP predictions in an attempt to obtain KW/TON (cyan). Sundays are the highlighted block(s). This is the mid-treatment time, the 500 hour window.\n\nThe figure separates data points into two groups, within (green) and outside (purple) three standard deviations from the median for the three Retail Chain A variables (KW/TON, COP, EER) across the various feature distributions.", "tokens": 607, "chars": 2665, "pages": {"start": 1, "end": 1}, "section": "", "prev_id": "umontana_001_chunk_0006", "next_id": "", "content_hash": "sha256:ed7dfb7cdcf615ff13bc92d44c23af680bb1b4a682021959bc57ce268fb0eb9c"}
